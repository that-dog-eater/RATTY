import sys
import random
import string
from datetime import datetime
import os

output_file_name = "shell77.cs"
comment_type = "//"

def read_file(path):
    """Read file and return list of lines."""
    with open(path, "r") as f:
        return f.readlines()

def add_comments(lines):
    """Insert random comment lines into the code."""
    new_lines = []
    for line in lines:
        new_lines.append(line)  # keep original line
        if random.random() < 0.1:  # 10% chance
            rand_num = random.randint(1000, 9999999)
            new_lines.append(f"{comment_type} {rand_num}\n")  # add newline at end
    return new_lines

def add_padding(modified_file):
    """Append visible random padding lines at the end of file."""
    with open(modified_file, "a") as f:
        padding_lines = random.randint(3, 10)
        for _ in range(padding_lines):
            chars = "".join(random.choices(string.ascii_letters + string.digits, k=30))
            f.write(f"{comment_type} {chars}\n")

if __name__ == "__main__":
    if len(sys.argv) > 1:
        original_file = sys.argv[1]
        lines = read_file(original_file)

        # Add random comments
        new_lines = add_comments(lines)

        # Build modified filename from argv[1]'s basename
        base_name, ext = os.path.splitext(os.path.basename(original_file))
        mod_file = output_file_name

        # Save result line by line
        with open(mod_file, "w") as f:
            f.writelines(new_lines)

        # Add visible random padding
        add_padding(mod_file)

        print(f"âœ… Saved modified version as {mod_file}")
    else:
        print("Usage: python poly.py <filename>")

